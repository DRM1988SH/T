const splash = document.getElementById('splash');
const loginScreen = document.getElementById('loginScreen');
const dashboard = document.getElementById('dashboard');
const settingsBtn = document.getElementById('settingsBtn');

let currentUser = null;
let invoiceNumber = 1;
const entries = [];

const users = [
  { jobNumber: '70062', role: 'admin', location: 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ' },
  { jobNumber: '80001', role: 'user', location: 'Ù…Ø¯ÙŠÙ†Ø© Ø²Ø§ÙŠØ¯' },
  { jobNumber: '80002', role: 'user', location: 'Ù…Ø¯ÙŠÙ†Ø© ØºÙŠØ§Ø«ÙŠ' },
];

// Splash
setTimeout(() => {
  splash.classList.remove('active');
  loginScreen.classList.add('active');
}, 2000);

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
function login() {
  const input = document.getElementById('jobNumber').value;
  const user = users.find(u => u.jobNumber === input);

  if (user) {
    currentUser = user;
    showScreen('dashboard');
    if (user.role !== 'admin') settingsBtn.style.display = 'none';
    else settingsBtn.style.display = 'inline-block';
  } else {
    alert('Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙØ© ØºÙŠØ± ØµØ­ÙŠØ­');
  }
}

function logout() {
  currentUser = null;
  showScreen('loginScreen');
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id)?.classList.add('active');
}

function generateOptions(start, end) {
  return Array.from({length: end - start + 1}, (_, i) =>
    `<option value="${start + i}">${start + i}</option>`
  ).join('');
}

function openInputScreen() {
  const screen = document.createElement('div');
  screen.id = 'inputScreen';
  screen.className = 'screen active';

  const loc = currentUser.role === 'admin'
    ? `<select id="inputLocation">
         <option>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
         <option>Ù…Ø¯ÙŠÙ†Ø© Ø²Ø§ÙŠØ¯</option>
         <option>Ù…Ø¯ÙŠÙ†Ø© ØºÙŠØ§Ø«ÙŠ</option>
       </select>`
    : `<p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${currentUser.location}</p>`;

  screen.innerHTML = `
    <div class="card">
      <h2>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
      ${loc}
      <input type="text" id="clientName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¹Ø§Ù…Ù„" />
      <input type="text" id="phoneNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙÙˆÙ†" />
      <p><strong>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</strong> ${invoiceNumber}</p>
      <select id="slaughterNumber">${generateOptions(1, 1000)}</select>
      <select id="stickerNumber">${generateOptions(1, 1000)}</select>
      <select id="animalType">
        <option>Ø®Ø±ÙˆÙ</option>
        <option>Ù…Ø§Ø¹Ø²</option>
        <option>Ø¨Ù‚Ø±</option>
        <option>Ø¹Ø¬Ù„ ØµØºÙŠØ±</option>
        <option>Ø­ÙˆØ§Ø± ØµØºÙŠØ±</option>
        <option>Ø¬Ù…Ù„</option>
      </select>
      <select id="cuttingType">
        <option>Ø¹Ø²ÙŠÙ…Ø©</option>
        <option>Ø«Ù„Ø§Ø¬Ø©</option>
        <option>ÙƒØ§Ù…Ù„</option>
      </select>
      <input type="number" id="price" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø®Ø¯Ù…Ø©" />
      <p><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> <span id="totalAmount">0</span> Ø¯Ø±Ù‡Ù…</p>
      <div>
        <label><input type="radio" name="payment" value="Ø¨Ø·Ø§Ù‚Ø©" checked /> Ø¨Ø·Ø§Ù‚Ø©</label>
        <label><input type="radio" name="payment" value="Ù†Ù‚Ø¯ÙŠ" /> Ù†Ù‚Ø¯ÙŠ</label>
      </div>
      <button onclick="submitEntry()">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ±Ø­ÙŠÙ„</button>
      <button onclick="printSticker()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø§Ø³ØªÙŠÙƒØ±</button>
      <button onclick="printInvoice()">ğŸ§¾ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
      <hr />
      <button onclick="showScreen('clientsScreen')">ğŸ“‹ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØªØ¹Ø§Ù…Ù„ÙŠÙ†</button>
      <button onclick="showScreen('reportScreen')">ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ</button>
      <button onclick="showScreen('dashboard')">ğŸ”™ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
  `;

  document.getElementById('app').innerHTML = '';
  document.getElementById('app').appendChild(screen);

  document.getElementById('price').addEventListener('input', e => {
    const total = parseFloat(e.target.value || 0);
    document.getElementById('totalAmount').textContent = total.toFixed(2);
  });
}

function submitEntry() {
  const name = document.getElementById('clientName').value;
  const phone = document.getElementById('phoneNumber').value;
  const price = parseFloat(document.getElementById('price').value || 0);
  const location = currentUser.role === 'admin'
    ? document.getElementById('inputLocation').value
    : currentUser.location;
  const payment = document.querySelector('input[name="payment"]:checked').value;

  entries.push({ name, phone, invoice: invoiceNumber, location, price, payment });

  updateTables();
  invoiceNumber++;
  openInputScreen();
}

function updateTables() {
  const clientBody = document.querySelector('#clientsTable tbody');
  const reportBody = document.querySelector('#reportTable tbody');
  clientBody.innerHTML = '';
  reportBody.innerHTML = '';

  entries.forEach(entry => {
    clientBody.innerHTML += `
      <tr>
        <td>${entry.name}</td>
        <td>${entry.phone}</td>
        <td>${entry.invoice}</td>
        <td>${entry.location}</td>
        <td>${entry.price} Ø¯Ø±Ù‡Ù…</td>
      </tr>`;
    reportBody.innerHTML += `
      <tr>
        <td>${entry.invoice}</td>
        <td>${entry.location}</td>
        <td>${entry.name}</td>
        <td>${entry.price} Ø¯Ø±Ù‡Ù…</td>
        <td>${entry.payment}</td>
      </tr>`;
  });
}

function printSticker() {
  alert('ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø§Ø³ØªÙŠÙƒØ± - ØªØ­Øª Ø§Ù„ØªØ·ÙˆÙŠØ±');
}

function printInvoice() {
  alert('ğŸ§¾ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© - ØªØ­Øª Ø§Ù„ØªØ·ÙˆÙŠØ±');
}
